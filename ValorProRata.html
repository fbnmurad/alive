<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Cálculo de Pró-Rata</title>
  <style>
    body { background: #f4f6f8; font-family: 'Segoe UI', Arial, sans-serif; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; margin: 0; }
    .container { background: #fff; margin-top: 40px; padding: 32px 30px 24px 30px; border-radius: 16px; box-shadow: 0 2px 24px rgba(0,0,0,0.07); width: 100%; max-width: 440px; }
    h2 { color: #2846b6; margin-bottom: 28px; text-align: center; font-weight: 600; letter-spacing: 0.5px; }
    label { font-weight: 500; color: #222b45; display: block; margin-bottom: 5px; margin-top: 16px; font-size: 15px; }
    input, select { width: 100%; padding: 9px 12px; font-size: 15px; margin-bottom: 2px; border-radius: 7px; border: 1px solid #bfc8d2; background: #f8fafc; transition: border-color 0.2s; outline: none; }
    input:focus, select:focus { border-color: #2846b6; }
    .botoes { display: flex; gap: 10px; margin-top: 22px; width: 100%; }
    button { flex: 1; background: linear-gradient(90deg, #416fff 0%, #2846b6 100%); color: #fff; font-size: 16px; font-weight: 600; border: none; border-radius: 7px; padding: 12px 0; cursor: pointer; transition: background 0.18s; box-shadow: 0 2px 6px rgba(60,80,200,0.09); }
    button.limpar { background: linear-gradient(90deg, #999 0%, #ccc 100%); color: #203068; }
    button:hover:not(.limpar) { background: linear-gradient(90deg, #2846b6 0%, #416fff 100%); }
    button.limpar:hover { background: linear-gradient(90deg, #888 0%, #bbb 100%); color: #18224d; }
    #resultado { margin-top: 30px; padding: 20px 15px 13px 15px; border-radius: 10px; background: #f1f5fe; color: #1d2543; font-size: 18px; text-align: center; box-shadow: 0 1px 4px rgba(40,70,182,0.07); }
    #resultado b { font-size: 1.13em; color: #2643e2; }
    .explicacao { font-size: 15px; color: #203068; margin-top: 18px; text-align: left; background: #e9ecfa; border-radius: 8px; padding: 15px 15px 5px 15px; }
    .explicacao span { color: #2643e2; font-weight: 500; font-family: 'Consolas', 'monospace', 'Courier New', monospace; }
    @media (max-width: 480px) { .container { padding: 14px 7px 14px 7px; max-width: 98vw; } .botoes { flex-direction: column; gap: 8px; } h2 { font-size: 1.1em; } #resultado { font-size: 16px; padding: 13px 2px 8px 2px; } .explicacao { font-size: 13px; padding: 11px 2px 5px 8px; } }
  </style>
</head>
<body>
  <div class="container">
    <h2>Cálculo de Valor Pró-Rata</h2>
    <label for="mes">Mês de Início:</label>
    <select id="mes">
      <option value="1">Janeiro</option><option value="2">Fevereiro</option><option value="3">Março</option>
      <option value="4">Abril</option><option value="5">Maio</option><option value="6">Junho</option>
      <option value="7">Julho</option><option value="8">Agosto</option><option value="9">Setembro</option>
      <option value="10">Outubro</option><option value="11">Novembro</option><option value="12">Dezembro</option>
    </select>
    <label for="ano">Ano de Início:</label>
    <input type="number" id="ano" value="2025">
    <label for="inicio">Dia de Início (1 a 31):</label>
    <input type="number" id="inicio" min="1" max="31">
    <label for="fim">Dia de Fim (1 a 31):</label>
    <input type="number" id="fim" min="1" max="31">
    <label for="quantidade">Quantidade de Licenças:</label>
    <input type="number" id="quantidade" min="1">
    <label for="preco">Preço Unitário (R$):</label>
    <input type="number" id="preco" step="0.01">
    <div class="botoes">
      <button onclick="calcularProRata()">Calcular</button>
      <button type="button" class="limpar" onclick="limparCampos()">Limpar</button>
    </div>
    <div id="resultado"></div>
  </div>
  <script>
    function calcularProRata() {
      // Captura os dados
      const mes = parseInt(document.getElementById("mes").value); // mês inicial
      const ano = parseInt(document.getElementById("ano").value);
      const inicio = parseInt(document.getElementById("inicio").value);
      const fim = parseInt(document.getElementById("fim").value);
      const quantidade = parseInt(document.getElementById("quantidade").value);
      const preco = parseFloat(document.getElementById("preco").value);

      if (isNaN(mes) || isNaN(ano) || isNaN(inicio) || isNaN(fim) || isNaN(quantidade) || isNaN(preco) ||
          inicio < 1 || inicio > 31 || fim < 1 || fim > 31 || quantidade < 1 || preco <= 0) {
        document.getElementById("resultado").innerHTML = "<span style='color:#c00'>Preencha todos os campos corretamente.</span>";
        return;
      }

      // Calcula data de início e fim corretamente
      let dataInicio = new Date(ano, mes - 1, inicio);
      let dataFim;
      if (fim >= inicio) {
        dataFim = new Date(ano, mes - 1, fim);
      } else {
        // Próximo mês (ajusta ano se for dezembro)
        let mesFim = mes;
        let anoFim = ano;
        if (mesFim === 12) { mesFim = 1; anoFim++; }
        else { mesFim++; }
        dataFim = new Date(anoFim, mesFim - 1, fim);
      }

      // Valida existência dos dias no mês de início e fim
      const diasNoMesInicio = new Date(ano, mes, 0).getDate();
      const diasNoMesFim = new Date(dataFim.getFullYear(), dataFim.getMonth() + 1, 0).getDate();
      if (inicio > diasNoMesInicio || fim > diasNoMesFim) {
        document.getElementById("resultado").innerHTML = "<span style='color:#c00'>Data de início ou fim inválida para o respectivo mês.</span>";
        return;
      }

      // Calcula o intervalo de dias (INCLUINDO os dois extremos)
      const diasUso = Math.floor((dataFim - dataInicio) / (24 * 3600 * 1000)) + 1;

      // Cálculo do pró-rata (valor por dia baseado no mês de INÍCIO)
      const valorPorDia = preco / diasNoMesInicio;
      const valorProrataUnitRaw = valorPorDia * diasUso;
      const valorProrataTotalRaw = valorProrataUnitRaw * quantidade;
      const valorUnitarioTrunc = Math.trunc(valorProrataUnitRaw * 100) / 100;
      const valorTotalTrunc = Math.trunc(valorProrataTotalRaw);

      // Formatação
      const valorPorDiaFormat = valorPorDia.toLocaleString('pt-BR', {minimumFractionDigits:8, maximumFractionDigits:8});
      const valorProrataUnitRawFormat = valorProrataUnitRaw.toLocaleString('pt-BR', {minimumFractionDigits:8, maximumFractionDigits:8});
      const valorProrataTotalRawFormat = valorProrataTotalRaw.toLocaleString('pt-BR', {minimumFractionDigits:2, maximumFractionDigits:8});

      document.getElementById("resultado").innerHTML = `
        <b>Período: ${dataInicio.toLocaleDateString()} a ${dataFim.toLocaleDateString()} (${diasUso} dias)</b><br>
        Valor Pró-Rata Unitário (truncado): <b>R$ ${valorUnitarioTrunc.toFixed(2).replace('.', ',')}</b><br>
        Valor Pró-Rata Total (truncado): <b>R$ ${valorTotalTrunc.toFixed(2).replace('.', ',')}</b>
        <div class="explicacao">
          <b>Como foi feito o cálculo?</b><br>
          1. Fórmula: TRUNC(((preço ÷ dias no mês de início) × dias de uso) × quantidade)<br>
          2. Valor por dia: <span>${preco} ÷ ${diasNoMesInicio} = R$ ${valorPorDiaFormat}</span><br>
          3. Dias de uso: <span>${diasUso} (de ${dataInicio.toLocaleDateString()} até ${dataFim.toLocaleDateString()})</span><br>
          4. Multiplicado pelos dias usados: <span>R$ ${valorPorDiaFormat} × ${diasUso} = R$ ${valorProrataUnitRawFormat}</span><br>
          5. Multiplicado pelas licenças: <span>R$ ${valorProrataUnitRawFormat} × ${quantidade} = R$ ${valorProrataTotalRawFormat}</span><br>
          6. Truncado para baixo: 
          <span>Valor Unitário = R$ ${valorUnitarioTrunc.toFixed(2).replace('.', ',')}, Valor Total = R$ ${valorTotalTrunc.toFixed(2).replace('.', ',')}</span>
        </div>
      `;
    }

    function limparCampos() {
      document.getElementById("mes").selectedIndex = 0;
      document.getElementById("ano").value = '';
      document.getElementById("inicio").value = '';
      document.getElementById("fim").value = '';
      document.getElementById("quantidade").value = '';
      document.getElementById("preco").value = '';
      document.getElementById("resultado").innerHTML = '';
    }
  </script>
</body>
</html>
